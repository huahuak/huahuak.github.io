<!DOCTYPE html>
<html lang="en"
  dir="ltr">

<head>
  
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)'], ['$', '$']]  
    }
  };
</script>
  
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title> | </title>

      <link rel="stylesheet" href="/css/main.min.4e3925258a07dcd1db9457696be79fd505b229e2280d31f3f622c14c35c26655.css" integrity="sha256-TjklJYoH3NHblFdpa&#43;ef1QWyKeIoDTHz9iLBTDXCZlU=" crossorigin="anonymous">
      <link rel="stylesheet" href="/css/var.min.f4ad28441b010d71b331e4a3acd0878a1f12df0c47c4e6d09c5087fa963c50f8.css" integrity="sha256-9K0oRBsBDXGzMeSjrNCHih8S3wxHxObQnFCH&#43;pY8UPg=" crossorigin="anonymous">


      <script src="/js/main.f2979a93a325fecf9605263bd141398a311c8e23388ed7dcff74f92f7e632866.js" integrity="sha256-8peak6Ml/s&#43;WBSY70UE5ijEcjiM4jtfc/3T5L35jKGY=" crossorigin="anonymous"></script>


<link rel="icon" type="image/ico" href="/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="/favicon.ico">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

</head>

<body>
  <div class="aside-layout">
    <aside id="sidebar"> <header>
  <div style="display: flex;">
    <button id="sidebar-lhs-button" onclick="toggleVisibility()" class="sidebar-ico"></button>
  </div>

  <div>
    <nav aria-label="breadcrumb" class="breadcrumb" style="display: flex; align-items: center;">
  <style>
    ol {
      margin: 0;
    }

    li {
      margin: 0;
    }

    .breadcrumb ol {
      padding-left: 0;
    }

    .breadcrumb li {
      display: inline;
    }

    .breadcrumb li:not(:last-child)::after {
       
      color: var(--blue);
      content: "·";
    }
  </style>
  <ol>
    
    <li>
      <a href="/"></a>
    </li>
    
    <li>
      <a href="/daily-note/">Daily-Notes</a>
    </li>
    
    <li class="active">
      <a aria-current="page" href="/daily-note/2022-09-15/"></a>
    </li>
  </ol>
</nav>
  </div>
</header>

<div class="main-container">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">OVERVIEW</a></li>
    <li><a href="#actor-model">Actor Model</a></li>
    <li><a href="#netty">Netty</a></li>
    <li><a href="#select--poll信号驱动-ioepoll">select / poll、信号驱动 IO、epoll</a></li>
    <li><a href="#java-nio">Java NIO</a></li>
  </ul>
</nav>
</div> </aside>
    <div id="right-board">
      <header> <div style="display: flex; align-items: center;">
  <button id="sidebar-rhs-button" style="display: none;" onclick="toggleVisibility()" class="sidebar-ico"></button>
  <a href="/" style="font-size: 2em; color: #222; text-decoration: none;">
    <span> HUAHUA </span>
  </a>
</div>

<div style="display: flex; align-items: center;">
  <button onclick="toggleEdit()" class="edit-ico" style="display: none;"></button>
  <button onclick="toggleSearch()" class="search-ico"></button>
  <a href="https://github.com/huahuak/huahuak.github.io">
    <span class="gh-ico"></span>
  </a>
</div>
 </header>
      <main class="center main-container">
        <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<style>
  .pagefind-ui__result-thumb.svelte-4xnkmf.svelte-4xnkmf {
    display: none;
  }
</style>
<div id="search" style="display: none; margin-top: 0.5em;"></div>
        

<h1 id="daily-note-09-15">Daily-Note 09-15</h1>
<h2 id="overview">OVERVIEW</h2>
<p>在分布式系统中，分布式高并发编程模型、socket 网络模型、IO 模型等属于了分布式系统的基石。</p>
<ol>
<li><strong>Actor Model</strong>，一种高性能分布式并发编程模型，来自 Erlang 语言。<a href="https://fuzhe1989.github.io/2018/05/17/message-passing-and-the-actor-model/">背景介绍</a></li>
<li><strong>Netty</strong>, Netty is a NIO client server framework which enables quick and easy  development of network applications such as protocol servers and  clients. It greatly simplifies and streamlines network programming such  as TCP and UDP socket server.</li>
<li><strong>select / poll、信号驱动 IO、epoll</strong>，多种非阻塞的操作系统 IO 模型。</li>
<li><strong>Java NIO</strong>，与 java 1.4 之前的 BIO 相比，NIO 提供了非阻塞的 IO 模型，大大提高了 Java 编程语言在大型应用服务器上的 IO 性能。</li>
</ol>
<h2 id="actor-model">Actor Model</h2>
<p><a href="https://github.com/guobinhit/akka-guide/blob/master/articles/getting-started-guide/actors-motivation.md">我们为什么需要 Actor 编程模型？</a></p>
<blockquote>
<p><a href="https://guobinhit.github.io/akka-guide/">akka 中文指南</a></p>
</blockquote>
<p>学习 akka actor <a href="https://doc.akka.io/docs/akka/current/typed/actors.html">example</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">akka.actor.typed.scaladsl.Behaviors</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">akka.actor.typed.scaladsl.LoggerOps</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">akka.actor.typed.</span><span style="color:#000">{</span><span style="color:#3f6e75">ActorRef</span><span style="color:#000">,</span> <span style="color:#3f6e75">ActorSystem</span><span style="color:#000">,</span> <span style="color:#3f6e75">Behavior</span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">object</span> <span style="color:#3f6e75">HelloWorld</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">final</span> <span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Greet</span><span style="color:#000">(</span><span style="color:#000">whom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span><span style="color:#000">,</span> <span style="color:#000">replyTo</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">ActorRef</span><span style="color:#000">[</span><span style="color:#a90d91">Greeted</span><span style="color:#000">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">final</span> <span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Greeted</span><span style="color:#000">(</span><span style="color:#000">whom</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span><span style="color:#000">,</span> <span style="color:#000">from</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">ActorRef</span><span style="color:#000">[</span><span style="color:#a90d91">Greet</span><span style="color:#000">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">def</span> <span style="color:#000">apply</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Behavior</span><span style="color:#000">[</span><span style="color:#a90d91">Greet</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span> <span style="color:#3f6e75">Behaviors</span><span style="color:#000">.</span><span style="color:#000">receive</span> <span style="color:#000">{</span> <span style="color:#000">(</span><span style="color:#000">context</span><span style="color:#000">,</span> <span style="color:#000">message</span><span style="color:#000">)</span> <span style="color:#a90d91">=&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">println</span><span style="color:#000">(</span><span style="color:#c41a16">s&#34;Hello </span><span style="color:#c41a16">${</span><span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">whom</span><span style="color:#c41a16">}</span><span style="color:#c41a16">!&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">replyTo</span> <span style="color:#000">!</span> <span style="color:#3f6e75">Greeted</span><span style="color:#000">(</span><span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">whom</span><span style="color:#000">,</span> <span style="color:#000">context</span><span style="color:#000">.</span><span style="color:#000">self</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3f6e75">Behaviors</span><span style="color:#000">.</span><span style="color:#000">same</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">object</span> <span style="color:#3f6e75">HelloWorldBot</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">def</span> <span style="color:#000">apply</span><span style="color:#000">(</span><span style="color:#000">max</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">)</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Behavior</span><span style="color:#000">[</span><span style="color:#a90d91">HelloWorld.Greeted</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">bot</span><span style="color:#000">(</span><span style="color:#1c01ce">0</span><span style="color:#000">,</span> <span style="color:#000">max</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">private</span> <span style="color:#a90d91">def</span> <span style="color:#000">bot</span><span style="color:#000">(</span><span style="color:#000">greetingCounter</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">,</span> <span style="color:#000">max</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Int</span><span style="color:#000">)</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Behavior</span><span style="color:#000">[</span><span style="color:#a90d91">HelloWorld.Greeted</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3f6e75">Behaviors</span><span style="color:#000">.</span><span style="color:#000">receive</span> <span style="color:#000">{</span> <span style="color:#000">(</span><span style="color:#000">context</span><span style="color:#000">,</span> <span style="color:#000">message</span><span style="color:#000">)</span> <span style="color:#a90d91">=&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a90d91">val</span> <span style="color:#000">n</span> <span style="color:#a90d91">=</span> <span style="color:#000">greetingCounter</span> <span style="color:#000">+</span> <span style="color:#1c01ce">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">println</span><span style="color:#000">(</span><span style="color:#c41a16">s&#34;Greeting </span><span style="color:#c41a16">$n</span><span style="color:#c41a16"> for </span><span style="color:#c41a16">${</span><span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">whom</span><span style="color:#c41a16">}</span><span style="color:#c41a16">&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#000">n</span> <span style="color:#000">==</span> <span style="color:#000">max</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3f6e75">Behaviors</span><span style="color:#000">.</span><span style="color:#000">stopped</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">}</span> <span style="color:#a90d91">else</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">from</span> <span style="color:#000">!</span> <span style="color:#3f6e75">HelloWorld</span><span style="color:#000">.</span><span style="color:#3f6e75">Greet</span><span style="color:#000">(</span><span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">whom</span><span style="color:#000">,</span> <span style="color:#000">context</span><span style="color:#000">.</span><span style="color:#000">self</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">bot</span><span style="color:#000">(</span><span style="color:#000">n</span><span style="color:#000">,</span> <span style="color:#000">max</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">object</span> <span style="color:#3f6e75">HelloWorldMain</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">final</span> <span style="color:#a90d91">case</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">SayHello</span><span style="color:#000">(</span><span style="color:#000">name</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">String</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">def</span> <span style="color:#000">apply</span><span style="color:#000">()</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Behavior</span><span style="color:#000">[</span><span style="color:#a90d91">SayHello</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3f6e75">Behaviors</span><span style="color:#000">.</span><span style="color:#000">setup</span> <span style="color:#000">{</span> <span style="color:#000">context</span> <span style="color:#a90d91">=&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a90d91">val</span> <span style="color:#000">greeter</span> <span style="color:#a90d91">=</span> <span style="color:#000">context</span><span style="color:#000">.</span><span style="color:#000">spawn</span><span style="color:#000">(</span><span style="color:#3f6e75">HelloWorld</span><span style="color:#000">(),</span> <span style="color:#c41a16">&#34;greeter&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#3f6e75">Behaviors</span><span style="color:#000">.</span><span style="color:#000">receiveMessage</span> <span style="color:#000">{</span> <span style="color:#000">message</span> <span style="color:#a90d91">=&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">val</span> <span style="color:#000">replyTo</span> <span style="color:#a90d91">=</span> <span style="color:#000">context</span><span style="color:#000">.</span><span style="color:#000">spawn</span><span style="color:#000">(</span><span style="color:#3f6e75">HelloWorldBot</span><span style="color:#000">(</span><span style="color:#000">max</span> <span style="color:#a90d91">=</span> <span style="color:#1c01ce">3</span><span style="color:#000">),</span> <span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">name</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">greeter</span> <span style="color:#000">!</span> <span style="color:#3f6e75">HelloWorld</span><span style="color:#000">.</span><span style="color:#3f6e75">Greet</span><span style="color:#000">(</span><span style="color:#000">message</span><span style="color:#000">.</span><span style="color:#000">name</span><span style="color:#000">,</span> <span style="color:#000">replyTo</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3f6e75">Behaviors</span><span style="color:#000">.</span><span style="color:#000">same</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">def</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">args</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Array</span><span style="color:#000">[</span><span style="color:#a90d91">String</span><span style="color:#000">])</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">Unit</span> <span style="color:#000">=</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">val</span> <span style="color:#000">system</span><span style="color:#a90d91">:</span> <span style="color:#a90d91">ActorSystem</span><span style="color:#000">[</span><span style="color:#a90d91">HelloWorldMain.SayHello</span><span style="color:#000">]</span> <span style="color:#a90d91">=</span>
</span></span><span style="display:flex;"><span>      <span style="color:#3f6e75">ActorSystem</span><span style="color:#000">(</span><span style="color:#3f6e75">HelloWorldMain</span><span style="color:#000">(),</span> <span style="color:#c41a16">&#34;hello&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">system</span> <span style="color:#000">!</span> <span style="color:#3f6e75">HelloWorldMain</span><span style="color:#000">.</span><span style="color:#3f6e75">SayHello</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;World&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">system</span> <span style="color:#000">!</span> <span style="color:#3f6e75">HelloWorldMain</span><span style="color:#000">.</span><span style="color:#3f6e75">SayHello</span><span style="color:#000">(</span><span style="color:#c41a16">&#34;Akka&#34;</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// This is run by ScalaFiddle
</span></span></span><span style="display:flex;"><span><span style="color:#177500">//HelloWorldMain.main(Array.empty)
</span></span></span></code></pre></div><h2 id="netty">Netty</h2>
<blockquote>
<p><a href="https://netty.io/wiki/user-guide-for-4.x.html#wiki-h3-17">Quick Start</a></p>
</blockquote>
<p>Netty Server demo, a simple echo server</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">NettyServer</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">NettyServer</span>(<span style="color:#a90d91">int</span> <span style="color:#000">port</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">NioEventLoopGroup</span> <span style="color:#000">bossG</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">NioEventLoopGroup</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#000">NioEventLoopGroup</span> <span style="color:#000">workerG</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">NioEventLoopGroup</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#000">ServerBootstrap</span> <span style="color:#000">serverBootstrap</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ServerBootstrap</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#000">serverBootstrap</span>.<span style="color:#836c28">group</span>(<span style="color:#000">bossG</span>, <span style="color:#000">workerG</span>).<span style="color:#836c28">channel</span>(<span style="color:#000">NioServerSocketChannel</span>.<span style="color:#836c28">class</span>).<span style="color:#836c28">childHandler</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">new</span> <span style="color:#000">ChannelInitializer</span><span style="color:#000">&lt;</span><span style="color:#000">SocketChannel</span><span style="color:#000">&gt;</span>() {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">protected</span> <span style="color:#a90d91">void</span> <span style="color:#000">initChannel</span>(<span style="color:#000">SocketChannel</span> <span style="color:#000">ch</span>) <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#000">ch</span>.<span style="color:#836c28">pipeline</span>().<span style="color:#836c28">addLast</span>(<span style="color:#a90d91">new</span> <span style="color:#000">ChannelInboundHandlerAdapter</span>() {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">channelRead</span>(<span style="color:#000">ChannelHandlerContext</span> <span style="color:#000">ctx</span>, <span style="color:#000">Object</span> <span style="color:#000">msg</span>) <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#000">ByteBuf</span> <span style="color:#000">buf</span> <span style="color:#000">=</span> (<span style="color:#000">ByteBuf</span>) <span style="color:#000">msg</span>;
</span></span><span style="display:flex;"><span>                                <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">bytes</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[</span><span style="color:#000">buf</span>.<span style="color:#836c28">readableBytes</span>()<span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>                                <span style="color:#000">buf</span>.<span style="color:#836c28">readBytes</span>(<span style="color:#000">bytes</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                <span style="color:#000">String</span> <span style="color:#000">req</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">String</span>(<span style="color:#000">bytes</span>, <span style="color:#c41a16">&#34;utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>                                <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">req</span>);
</span></span><span style="display:flex;"><span>                                <span style="color:#000">String</span> <span style="color:#000">resp</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#34;echo : &#34;</span> <span style="color:#000">+</span> <span style="color:#000">req</span>;
</span></span><span style="display:flex;"><span>                                <span style="color:#000">ByteBuf</span> <span style="color:#000">outbuf</span> <span style="color:#000">=</span> <span style="color:#000">Unpooled</span>.<span style="color:#836c28">copiedBuffer</span>(<span style="color:#000">resp</span>.<span style="color:#836c28">getBytes</span>());
</span></span><span style="display:flex;"><span>                                <span style="color:#000">ctx</span>.<span style="color:#836c28">write</span>(<span style="color:#000">outbuf</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">channelReadComplete</span>(<span style="color:#000">ChannelHandlerContext</span> <span style="color:#000">ctx</span>) <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#000">ctx</span>.<span style="color:#836c28">flush</span>();
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">exceptionCaught</span>(<span style="color:#000">ChannelHandlerContext</span> <span style="color:#000">ctx</span>, <span style="color:#000">Throwable</span> <span style="color:#000">cause</span>) <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#000">cause</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        });
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000">ChannelFuture</span> <span style="color:#000">f</span> <span style="color:#000">=</span> <span style="color:#000">serverBootstrap</span>.<span style="color:#836c28">bind</span>(<span style="color:#000">port</span>).<span style="color:#836c28">sync</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">f</span>.<span style="color:#836c28">channel</span>().<span style="color:#836c28">closeFuture</span>().<span style="color:#836c28">sync</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#a90d91">catch</span> (<span style="color:#000">InterruptedException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">bossG</span>.<span style="color:#836c28">shutdownGracefully</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">workerG</span>.<span style="color:#836c28">shutdownGracefully</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">new</span> <span style="color:#000">NettyServer</span>(<span style="color:#000">8082</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="select--poll信号驱动-ioepoll">select / poll、信号驱动 IO、epoll</h2>
<blockquote>
<p>Linux-UNIX 系统编程手册</p>
</blockquote>
<ol>
<li>
<p><strong>水平触发 &amp; 边缘触发</strong>，<strong>水平触发通知</strong>:如果文件描述符上可以非阻塞地执行 I/O 系统调用，此时认为它已经就绪。<strong>边缘触发通知</strong>:如果文件描述符自上次状态检查以来有了新的 I/O 活动(比如新的输入)，此时需要触发通知。</p>
</li>
<li>
<p><strong>select 和 poll 这种 IO 模型</strong>，首先，将感兴趣的文件描述符集合复制到内核空间中，系统通过顺序扫描检查感兴趣的文件描述符中发生的状态，然后设置其状态，然后返回给调用者，可以通过 timeout 参数设置是否阻塞、非阻塞、超时等待等方式，调用者获得结果后顺序检查感兴趣的文件描述符集合，从中找到发生的 IO 事件。</p>
</li>
<li>
<p><strong>信号驱动 IO 这种模型</strong>，首先，需要通过 sigaction 函数调用设置需要监听的文件描述符的 IO 事件以及发生 IO 就绪时唤醒的进程或进程组，并设置对应的回调处理函数，当 IO 就绪时将调用指定的回调函数，该模式下的触发为边缘触发，因此需要尽可能读取输入。与 select / poll 不同的是，该模式下内核空间会记录对应的文件描述符，因此不需要每次查询都复制对应的文件描述符到内核空间中，因此性能有大幅度的提升。</p>
</li>
<li>
<p><strong>epoll 这种 IO 模型下</strong>，首先，通过 epoll_create() 函数调用获取到一个关联到内核空间指定数据结构的文件描述符（但是不适用于 IO），接着，调用 epoll_ctl() 函数设置触发模式，对应的感兴趣文件描述符，最后，通过 epoll_wait() 函数返回一个就绪列表（ready list）该列表中即发生对应 IO 就绪事件的列表。</p>
<p>与信号驱动的 IO 模型相同，内核空间会记录对应的数据结构，因此不需要每次查询都复制文件描述符到内核空间。与信号驱动模式不同的是，该模式包括两种触发模式，而信号驱动 IO 只有边缘触发模式，此外该模式能够指定触发的 IO 事件为写就绪还是读就绪，并且不需要处理信号驱动 IO 模式下存在的排队信号溢出的问题。</p>
</li>
<li>
<p><strong>OTHER</strong></p>
<ul>
<li>epoll 相对于 select 的性能提升来自于系统实现的 callback，使得无需线性扫描所有的文件描述符，而是由文件描述符自身就绪时通知内核。<em>因此如果在大量文件描述符都处于活跃状态时，select 和 epoll 的性能差距并不明显</em>。</li>
</ul>
</li>
</ol>
<h2 id="java-nio">Java NIO</h2>
<blockquote>
<p>Netty 权威指南</p>
<p><a href="https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-netpoller/">GoLang 中的 IO 模型</a></p>
</blockquote>
<ol>
<li>NIO 涉及 buffer、channel、selector 等概念，其中 selector 作为复用器能够监听多个 selector 的 IO 事件，因此相对于 socket 编程中传统的 BIO 每一个连接建立一个线程进行处理（或通过线程池处理）其开销更低。NIO 所有的通信都需要通过 buffer 进行传递，buffer 是内存中的缓存区，读写都是直接对缓存区的读写。</li>
</ol>
<ul>
<li><input checked="" disabled="" type="checkbox"> 实验：多种 IO 下 socket 编程对比</li>
</ul>
<p>NIO 编程</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">// main</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">com.example</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * Hello world!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">App</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">App</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * Says hello to the world.
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * @param args The arguments of the program.
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#c41a16">&#34;Hello World!&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">new</span> <span style="color:#000">NIOServer</span>(<span style="color:#000">8081</span>).<span style="color:#836c28">run</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#177500">// NIO server</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">com.example</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.IOException</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.net.InetSocketAddress</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.ByteBuffer</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.channels.SelectionKey</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.channels.Selector</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.channels.ServerSocketChannel</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.channels.SocketChannel</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Iterator</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Set</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Server</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Runnable</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">Selector</span> <span style="color:#000">selector</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">ServerSocketChannel</span> <span style="color:#000">serverChannel</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">running</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Server</span>(<span style="color:#a90d91">int</span> <span style="color:#000">port</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000">selector</span> <span style="color:#000">=</span> <span style="color:#000">Selector</span>.<span style="color:#836c28">open</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">serverChannel</span> <span style="color:#000">=</span> <span style="color:#000">ServerSocketChannel</span>.<span style="color:#836c28">open</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">serverChannel</span>.<span style="color:#836c28">socket</span>().<span style="color:#836c28">bind</span>(<span style="color:#a90d91">new</span> <span style="color:#000">InetSocketAddress</span>(<span style="color:#000">port</span>), <span style="color:#000">1024</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#000">serverChannel</span>.<span style="color:#836c28">configureBlocking</span>(<span style="color:#a90d91">false</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#000">serverChannel</span>.<span style="color:#836c28">register</span>(<span style="color:#000">selector</span>, <span style="color:#000">SelectionKey</span>.<span style="color:#836c28">OP_ACCEPT</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">running</span> <span style="color:#000">=</span> <span style="color:#a90d91">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#a90d91">catch</span> (<span style="color:#000">IOException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">handle</span>(<span style="color:#000">SelectionKey</span> <span style="color:#000">key</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> (<span style="color:#000">key</span>.<span style="color:#836c28">isValid</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">key</span>.<span style="color:#836c28">isAcceptable</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">ServerSocketChannel</span> <span style="color:#000">channel</span> <span style="color:#000">=</span> (<span style="color:#000">ServerSocketChannel</span>) <span style="color:#000">key</span>.<span style="color:#836c28">channel</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">SocketChannel</span> <span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">channel</span>.<span style="color:#836c28">accept</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#000">c</span>.<span style="color:#836c28">configureBlocking</span>(<span style="color:#a90d91">false</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#000">c</span>.<span style="color:#836c28">register</span>(<span style="color:#000">selector</span>, <span style="color:#000">SelectionKey</span>.<span style="color:#836c28">OP_READ</span>);
</span></span><span style="display:flex;"><span>                } <span style="color:#a90d91">catch</span> (<span style="color:#000">IOException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> (<span style="color:#000">key</span>.<span style="color:#836c28">isReadable</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">SocketChannel</span> <span style="color:#000">sc</span> <span style="color:#000">=</span> (<span style="color:#000">SocketChannel</span>) <span style="color:#000">key</span>.<span style="color:#836c28">channel</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#000">ByteBuffer</span> <span style="color:#000">buf</span> <span style="color:#000">=</span> <span style="color:#000">ByteBuffer</span>.<span style="color:#836c28">allocate</span>(<span style="color:#000">4096</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">int</span> <span style="color:#000">read</span> <span style="color:#000">=</span> <span style="color:#000">sc</span>.<span style="color:#836c28">read</span>(<span style="color:#000">buf</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">if</span> (<span style="color:#000">read</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#177500">// read</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">buf</span>.<span style="color:#836c28">flip</span>();
</span></span><span style="display:flex;"><span>                        <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">bytes</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[</span><span style="color:#000">buf</span>.<span style="color:#836c28">remaining</span>()<span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>                        <span style="color:#000">buf</span>.<span style="color:#836c28">get</span>(<span style="color:#000">bytes</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#000">String</span> <span style="color:#000">req</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">String</span>(<span style="color:#000">bytes</span>, <span style="color:#c41a16">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">req</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        <span style="color:#177500">// write</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000">String</span> <span style="color:#000">resp</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#34;echo : &#34;</span> <span style="color:#000">+</span> <span style="color:#000">req</span>;
</span></span><span style="display:flex;"><span>                        <span style="color:#000">buf</span>.<span style="color:#836c28">clear</span>();
</span></span><span style="display:flex;"><span>                        <span style="color:#000">buf</span>.<span style="color:#836c28">put</span>(<span style="color:#000">resp</span>.<span style="color:#836c28">getBytes</span>());
</span></span><span style="display:flex;"><span>                        <span style="color:#000">buf</span>.<span style="color:#836c28">flip</span>();
</span></span><span style="display:flex;"><span>                        <span style="color:#000">sc</span>.<span style="color:#836c28">write</span>(<span style="color:#000">buf</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#a90d91">catch</span> (<span style="color:#000">IOException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">while</span> (<span style="color:#000">running</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#000">selector</span>.<span style="color:#836c28">select</span>(<span style="color:#000">1000</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#000">Set</span><span style="color:#000">&lt;</span><span style="color:#000">SelectionKey</span><span style="color:#000">&gt;</span> <span style="color:#000">selectedKeys</span> <span style="color:#000">=</span> <span style="color:#000">selector</span>.<span style="color:#836c28">selectedKeys</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#000">Iterator</span><span style="color:#000">&lt;</span><span style="color:#000">SelectionKey</span><span style="color:#000">&gt;</span> <span style="color:#000">it</span> <span style="color:#000">=</span> <span style="color:#000">selectedKeys</span>.<span style="color:#836c28">iterator</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#000">SelectionKey</span> <span style="color:#000">next</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">while</span> (<span style="color:#000">it</span>.<span style="color:#836c28">hasNext</span>()) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000">next</span> <span style="color:#000">=</span> <span style="color:#000">it</span>.<span style="color:#836c28">next</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#000">it</span>.<span style="color:#836c28">remove</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#000">handle</span>(<span style="color:#000">next</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#a90d91">catch</span> (<span style="color:#000">IOException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>NIO2.0 编程</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">com.example</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> * Hello world!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">App</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">App</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * Says hello to the world.
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * 
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * @param args The arguments of the program.
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#c41a16">&#34;Hello World!&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">new</span> <span style="color:#000">AIOServer</span>(<span style="color:#000">8081</span>).<span style="color:#836c28">run</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">com.example</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.IOException</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.UnsupportedEncodingException</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.net.InetSocketAddress</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.ByteBuffer</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.channels.AsynchronousServerSocketChannel</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.channels.AsynchronousSocketChannel</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.nio.channels.CompletionHandler</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">AIOServer</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#000">AsynchronousServerSocketChannel</span> <span style="color:#000">asyncSC</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">AIOServer</span>(<span style="color:#a90d91">int</span> <span style="color:#000">port</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000">asyncSC</span> <span style="color:#000">=</span> <span style="color:#000">AsynchronousServerSocketChannel</span>.<span style="color:#836c28">open</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#000">asyncSC</span>.<span style="color:#836c28">bind</span>(<span style="color:#a90d91">new</span> <span style="color:#000">InetSocketAddress</span>(<span style="color:#000">port</span>));
</span></span><span style="display:flex;"><span>        } <span style="color:#a90d91">catch</span> (<span style="color:#000">IOException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#000">asyncSC</span>.<span style="color:#836c28">accept</span>(<span style="color:#a90d91">this</span>, <span style="color:#a90d91">new</span> <span style="color:#000">CompletionHandler</span><span style="color:#000">&lt;</span><span style="color:#000">AsynchronousSocketChannel</span>, <span style="color:#000">AIOServer</span><span style="color:#000">&gt;</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">completed</span>(<span style="color:#000">AsynchronousSocketChannel</span> <span style="color:#000">result</span>, <span style="color:#000">AIOServer</span> <span style="color:#000">attachment</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">attachment</span>.<span style="color:#836c28">asyncSC</span>.<span style="color:#836c28">accept</span>(<span style="color:#000">attachment</span>, <span style="color:#a90d91">this</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#000">ByteBuffer</span> <span style="color:#000">buf</span> <span style="color:#000">=</span> <span style="color:#000">ByteBuffer</span>.<span style="color:#836c28">allocate</span>(<span style="color:#000">1024</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">final</span> <span style="color:#000">AsynchronousSocketChannel</span> <span style="color:#000">ch</span> <span style="color:#000">=</span> <span style="color:#000">result</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#000">result</span>.<span style="color:#836c28">read</span>(<span style="color:#000">buf</span>, <span style="color:#000">buf</span>, <span style="color:#a90d91">new</span> <span style="color:#000">CompletionHandler</span><span style="color:#000">&lt;</span><span style="color:#000">Integer</span>, <span style="color:#000">ByteBuffer</span><span style="color:#000">&gt;</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">completed</span>(<span style="color:#000">Integer</span> <span style="color:#000">result</span>, <span style="color:#000">ByteBuffer</span> <span style="color:#000">attachment</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#a90d91">if</span> (<span style="color:#000">result</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span>) {
</span></span><span style="display:flex;"><span>                            <span style="color:#000">attachment</span>.<span style="color:#836c28">flip</span>();
</span></span><span style="display:flex;"><span>                            <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">bytes</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[</span><span style="color:#000">attachment</span>.<span style="color:#836c28">remaining</span>()<span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>                            <span style="color:#000">attachment</span>.<span style="color:#836c28">get</span>(<span style="color:#000">bytes</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                            <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#000">String</span> <span style="color:#000">req</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">String</span>(<span style="color:#000">bytes</span>, <span style="color:#c41a16">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>                                <span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">req</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                                <span style="color:#000">String</span> <span style="color:#000">resp</span> <span style="color:#000">=</span> <span style="color:#c41a16">&#34;echo : &#34;</span> <span style="color:#000">+</span> <span style="color:#000">req</span>;
</span></span><span style="display:flex;"><span>                                <span style="color:#000">buf</span>.<span style="color:#836c28">clear</span>();
</span></span><span style="display:flex;"><span>                                <span style="color:#000">buf</span>.<span style="color:#836c28">put</span>(<span style="color:#000">resp</span>.<span style="color:#836c28">getBytes</span>());
</span></span><span style="display:flex;"><span>                                <span style="color:#000">buf</span>.<span style="color:#836c28">flip</span>();
</span></span><span style="display:flex;"><span>                                <span style="color:#000">ch</span>.<span style="color:#836c28">write</span>(<span style="color:#000">buf</span>);
</span></span><span style="display:flex;"><span>                              	
</span></span><span style="display:flex;"><span>                              	<span style="color:#177500">// redo </span>
</span></span><span style="display:flex;"><span>                                <span style="color:#000">buf</span>.<span style="color:#836c28">clear</span>();
</span></span><span style="display:flex;"><span>                                <span style="color:#000">ch</span>.<span style="color:#836c28">read</span>(<span style="color:#000">buf</span>, <span style="color:#000">buf</span>, <span style="color:#a90d91">this</span>);
</span></span><span style="display:flex;"><span>                            } <span style="color:#a90d91">catch</span> (<span style="color:#000">UnsupportedEncodingException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>                                <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">failed</span>(<span style="color:#000">Throwable</span> <span style="color:#000">exc</span>, <span style="color:#000">ByteBuffer</span> <span style="color:#000">attachment</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000">exc</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">failed</span>(<span style="color:#000">Throwable</span> <span style="color:#000">exc</span>, <span style="color:#000">AIOServer</span> <span style="color:#000">attachment</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#000">exc</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#000">Thread</span>.<span style="color:#836c28">sleep</span>(<span style="color:#000">2000</span> <span style="color:#000">*</span> <span style="color:#000">1000</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#a90d91">catch</span> (<span style="color:#000">InterruptedException</span> <span style="color:#000">e</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#000">e</span>.<span style="color:#836c28">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><input disabled="" type="checkbox"> 性能测试</li>
<li><input disabled="" type="checkbox"> 对比 Go、Rust 等语言 IO 模型</li>
</ul>



        <style>
  .utterances {
    margin-top: 30svh;
    border-top: 1px solid var(--gray);
  }
</style>

<div id="utterances-container"></div>
<script>
  var repo = "huahuak/huahuak.github.io";
  var issueTerm = btoa(location.pathname);
  var theme = "github-light";
  (function () {
    var container = document.getElementById("utterances-container");
    var script = document.createElement("script");
    script.src = "https://utteranc.es/client.js";
    script.setAttribute("repo", repo);
    script.setAttribute("issue-term", issueTerm);
    script.setAttribute("theme", theme);
    script.crossorigin = "anonymous";
    script.async = true;
    container.appendChild(script);
  })();

</script>
      </main>
      <footer>  </footer>
    </div>
  </div>
</body>







<script>
  
  
  
  const localPrefix = "http://localhost:8080/Users/huahua/Library/Mobile%20Documents/com~apple~CloudDocs/HUAHUA/iNOTE";
  var localFunc = []
  window.onload = () => {
    fetch('http://localhost:8080/ping')
      .then((_1, _2) => { localFunc.forEach((f, _1, _2) => f()) })
      .catch(error => console.error('Error:', error));
  }

  
  
  
  function toggleVisibility() {
    let lbtn = document.getElementById("sidebar-lhs-button")
    let rbtn = document.getElementById("sidebar-rhs-button")
    var asideLayout = document.querySelector("div.aside-layout");
    var sidebar = document.getElementById("sidebar");
    if (sidebar.style.display === "none") {
      sidebar.style.display = "block"; 
      var rootStyles = getComputedStyle(document.documentElement);
      var asidePercent = rootStyles.getPropertyValue('--aside-percent');
      asideLayout.style.gridTemplateColumns = asidePercent;

      lbtn.style.display = "block"
      rbtn.style.display = "none"
    } else {
      sidebar.style.display = "none"; 
      asideLayout.style.gridTemplateColumns = '100svw';

      rbtn.style.display = "block"
      lbtn.style.display = "none"
    }
  }

  
  
  
  var oldScroll = 0
  function toggleSearch() {
    let search = document.getElementById("search")
    var main = document.getElementsByTagName("main")[0]
    if (search.style.display !== 'none') {
      search.style.display = 'none'
      main.scrollTop = oldScroll
    } else {
      search.style.display = 'block'
      document.getElementsByTagName('input')[0].focus()
      oldScroll = main.scrollTop
      main.scrollTop = 0
    }
  }

  
  
  
  var path = 'daily-note\/2022-09-15.md'
  localFunc.push(() => {
    document.getElementsByClassName("edit-ico")[0].style.display = "block"
  })
  function toggleEdit() {
    fetch(localPrefix + "/" + path)
      .catch(error => console.error('Error:', error));
  }

  
  var mediaQuery = window.matchMedia('(max-width: 600px)');
  if (mediaQuery.matches) {
    var sidebar = document.getElementById('sidebar');
    sidebar.addEventListener('click', function (event) {
      if (event.target.tagName === 'A') {
        toggleVisibility()
      }
    });

    document.getElementById("sidebar-rhs-button").style.display = "block"
  }

  
  
  
  const prefix = 'daily-note\/'
  var base = document.getElementsByTagName("main")[0]

  const wrapLink = link => {
    var pre = prefix
    if (link.includes("http")) {
      return link
    }
    if (link.startsWith("#")) {
      return link
    }
    if (link.startsWith("/")) {
      return link
    }
    if (prefix !== '/') {
      pre = '/' + prefix
    }
    link = pre + link
    link = link.replace(".md", "")
    return link
  }

  Array.from(base.getElementsByTagName('img')).forEach(item => {
    item.setAttribute('src', wrapLink(item.getAttribute('src')))
  })
  Array.from(base.getElementsByTagName('a')).forEach(item => {
    let old = item.getAttribute('href')
    let link = wrapLink(old)
    if (old !== link && link.includes(".")) {
      localFunc.push(() => {
        item.addEventListener('click', event => {
          event.preventDefault()
          fetch(localPrefix + link)
            .catch(error => console.error('Error:', error));
        })
      })
    }
    item.setAttribute('href', link)
  })

  
  
  
  var main = document.getElementsByTagName("main")[0]
  document.querySelectorAll('a[href^="#"]').forEach((v, _1, _2) => {
    v.addEventListener('click', function (e) {
      e.preventDefault();
      var targetId = this.getAttribute("href").slice(1);
      var targetElement = document.getElementById(targetId);
      if (targetElement) {
        main.scrollTo({
          top: targetElement.offsetTop - 54,
          behavior: 'smooth'
        });
      }
    })
  });

  
  
  
  main.addEventListener('scroll', function () {
    var sections = document.querySelectorAll('main h2, main h3');
    var scrollPosition = main.scrollTop + 54;
    for (var i = 0; i < sections.length; i++) {
      var currentSection = sections[i];
      if (scrollPosition >= sections[i].offsetTop && (i + 1 >= sections.length || scrollPosition < sections[i + 1].offsetTop)) {
        document.querySelector('#sidebar #TableOfContents a[href="#' + currentSection.id + '"]').style.fontWeight = 'bold';
      } else {
        document.querySelector('#sidebar #TableOfContents a[href="#' + currentSection.id + '"]').style.fontWeight = 'normal';
      }

    }
  });


  
  
  
  window.addEventListener('scroll', function () {
    window.scrollTo({ top: 0 })
  });
  window.addEventListener('DOMContentLoaded', (event) => {
    new PagefindUI({ element: "#search", showSubResults: true });
  });

</script>

</html>